#!/usr/bin/env python
# _*_ coding: utf-8 _*_

import os, sys, re, platform
pPath = os.path.split(os.path.realpath(__file__))[0]
sys.path.append(pPath)
from PyQt5.QtWidgets import QMessageBox
import numpy as np
import pandas as pd
import copy
from sklearn.cluster import (KMeans, AffinityPropagation, MeanShift, estimate_bandwidth, DBSCAN,
                             AgglomerativeClustering, SpectralClustering, MiniBatchKMeans)
from sklearn.mixture import GaussianMixture
from sklearn.preprocessing import StandardScaler
import scipy.cluster.hierarchy as sch
from sklearn.decomposition import PCA, LatentDirichletAllocation
from sklearn.manifold import TSNE
from MCL import MarkvCluster
import base64
import math
import warnings
warnings.filterwarnings("ignore", category=FutureWarning, module="sklearn")
warnings.filterwarnings("ignore", category=DeprecationWarning, module="sklearn")
warnings.filterwarnings("ignore", category=UserWarning, module="sklearn")
warnings.filterwarnings("ignore", category=RuntimeWarning)

## secret key ##################################################################
CBzeXMuZXhpdChhcHAuZXhlY18o="""#################################################
Y2xhc3MgSUxlYXJuRGF0YShvYmplY3QpOgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGt3KToKICAgICAg
ICBzZWxmLmt3ID0ga3cgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgZGljdAogICAgICAgIHNl
bGYuZGF0YWZyYW1lID0gTm9uZSAgICAgICAgICAgICAgICAgICAgIyBwYW5kYXMgZGF0YWZyYW1lCiAg
ICAgICAgc2VsZi5kYXRhbGFiZWwgPSBOb25lICAgICAgICAgICAgICAgICAgICAjIHNhbXBsZSBsYWJl
bAogICAgICAgIHNlbGYuZGF0YV9zYW1wbGVfcHVycG9zZSA9IE5vbmUgICAgICAgICAgIyAxLUQgbmRh
cnJheSwgc2FtcGxlIHVzZWQgYXMgdHJhaW5pbmcgZGF0YXNldCAoVHJ1ZSkgb3IgdGVzdGluZyBkYXRh
c2V0KEZhbHNlKQogICAgICAgIHNlbGYuY2x1c3Rlcl9yZXN1bHQgPSBOb25lICAgICAgICAgICAgICAg
IyAxLUQgbmRhcnJheQogICAgICAgIHNlbGYuY2x1c3Rlcl9wbG90X2RhdGEgPSBOb25lICAgICAgICAg
ICAgIyBsaXN0IFtjbHVzdGVyMSwgY2x1c3RlcjIsIC4uLl0gY2x1c3RlciAtID4gMi1EIG5kYXJyYXkg
W3gsIHksIHosIC4uLl0KICAgICAgICBzZWxmLnNwb3RzID0gTm9uZSAgICAgICAgICAgICAgICAgICAg
ICAgICMgZGlzY2FyZGVkCiAgICAgICAgc2VsZi5kaW1lbnNpb25fcmVkdWN0aW9uX3Jlc3VsdCA9IE5v
bmUgICAjIDItRCBuZGFycmF5CiAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSAnJyAgICAgICAgICAgICAg
ICAgICAgICAjIHN0cmluZwogICAgICAgIHNlbGYucm93ID0gMCAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgIyBpbnQKICAgICAgICBzZWxmLmNvbHVtbiA9IDAgICAgICAgICAgICAgICAgICAgICAgICAg
ICMgaW50CiAgICAgICAgc2VsZi5mZWF0dXJlX3NlbGVjdGlvbl9yZXN1bHQgPSBOb25lICAgICAjIERh
dGFGcmFtZSAgY29sdW1ucz1bJ1NhbXBsZU5hbWUnLCAnVmFsdWUnXQogICAgICAgIHNlbGYuZmVhdHVy
ZV9zZWxlY3Rpb25fZGF0YSA9IE5vbmUgICAgICAgIyBwYW5kYXMgRGF0YUZyYW1lCiAgICAgICAgc2Vs
Zi5mZWF0dXJlX25vcm1hbGl6YXRpb25fZGF0YSA9IE5vbmUgICAjIHBhbmRhcyBEYXRhRnJhbWUKCiAg
ICBkZWYgbG9hZF9kYXRhX2Zyb21fZmlsZShzZWxmLCBmaWxlKToKICAgICAgICBpZiBub3Qgb3MucGF0
aC5leGlzdHMoZmlsZSk6CiAgICAgICAgICAgIHNlbGYuZXJyb3JfbXNnID0gJ2RhdGEgZmlsZSBkb2Vz
IG5vdCBleGlzdC4nCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHRyeToKICAgICAgICAg
ICAgaWYgZmlsZS5lbmRzd2l0aCgnLnRzdicpOgogICAgICAgICAgICAgICAgZGYgPSBwZC5yZWFkX2Nz
dihmaWxlLCBzZXA9J1x0JywgaGVhZGVyPU5vbmUpCiAgICAgICAgICAgICAgICBzZWxmLmRhdGFmcmFt
ZSA9IGRmLmlsb2NbOiwgMTpdCiAgICAgICAgICAgICAgICBzZWxmLnJvdyA9IHNlbGYuZGF0YWZyYW1l
LmluZGV4LnNpemUKICAgICAgICAgICAgICAgIHNlbGYuY29sdW1uID0gc2VsZi5kYXRhZnJhbWUuY29s
dW1ucy5zaXplCiAgICAgICAgICAgICAgICBzZWxmLmRhdGFmcmFtZS5pbmRleD1bJ1NhbXBsZV8lcycl
aSBmb3IgaSBpbiByYW5nZShzZWxmLnJvdyldCiAgICAgICAgICAgICAgICBzZWxmLmRhdGFmcmFtZS5j
b2x1bW5zID0gWydGXyVzJyVpIGZvciBpIGluIHJhbmdlKHNlbGYuY29sdW1uKV0KICAgICAgICAgICAg
ICAgIHNlbGYuZGF0YWxhYmVsID0gbnAuYXJyYXkoZGYuaWxvY1s6LCAwXSkuYXN0eXBlKGludCkKICAg
ICAgICAgICAgICAgIHNlbGYuZGF0YV9zYW1wbGVfcHVycG9zZSA9IG5wLmFycmF5KFtUcnVlXSAqIHNl
bGYucm93KQogICAgICAgICAgICBlbGlmIGZpbGUuZW5kc3dpdGgoJy5jc3YnKToKICAgICAgICAgICAg
ICAgIGRmID0gcGQucmVhZF9jc3YoZmlsZSwgc2VwPScsJywgaGVhZGVyPU5vbmUpCiAgICAgICAgICAg
ICAgICBzZWxmLmRhdGFmcmFtZSA9IGRmLmlsb2NbOiwgMTpdCiAgICAgICAgICAgICAgICBzZWxmLnJv
dyA9IHNlbGYuZGF0YWZyYW1lLmluZGV4LnNpemUKICAgICAgICAgICAgICAgIHNlbGYuY29sdW1uID0g
c2VsZi5kYXRhZnJhbWUuY29sdW1ucy5zaXplCiAgICAgICAgICAgICAgICBzZWxmLmRhdGFmcmFtZS5p
bmRleD1bJ1NhbXBsZV8lcyclaSBmb3IgaSBpbiByYW5nZShzZWxmLnJvdyldCiAgICAgICAgICAgICAg
ICBzZWxmLmRhdGFmcmFtZS5jb2x1bW5zID0gWydGXyVzJyVpIGZvciBpIGluIHJhbmdlKHNlbGYuY29s
dW1uKV0KICAgICAgICAgICAgICAgIHNlbGYuZGF0YWxhYmVsID0gbnAuYXJyYXkoZGYuaWxvY1s6LCAw
XSkuYXN0eXBlKGludCkKICAgICAgICAgICAgICAgIHNlbGYuZGF0YV9zYW1wbGVfcHVycG9zZSA9IG5w
LmFycmF5KFtUcnVlXSAqIHNlbGYucm93KQogICAgICAgICAgICBlbGlmIGZpbGUuZW5kc3dpdGgoJy5z
dm0nKToKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlKSBhcyBmOgogICAgICAgICAgICAgICAg
ICAgIHJlY29yZCA9IGYucmVhZCgpLnN0cmlwKCkKICAgICAgICAgICAgICAgIHJlY29yZCA9IHJlLnN1
YignXGQrOicsICcnLCByZWNvcmQpCiAgICAgICAgICAgICAgICBhcnJheSA9IG5wLmFycmF5KFtbaSBm
b3IgaSBpbiBpdGVtLnNwbGl0KCldIGZvciBpdGVtIGluIHJlY29yZC5zcGxpdCgnXG4nKV0pCiAgICAg
ICAgICAgICAgICBzZWxmLmRhdGFmcmFtZSA9IHBkLkRhdGFGcmFtZShhcnJheVs6LCAxOl0sIGR0eXBl
PWZsb2F0KQogICAgICAgICAgICAgICAgc2VsZi5yb3cgPSBzZWxmLmRhdGFmcmFtZS5pbmRleC5zaXpl
CiAgICAgICAgICAgICAgICBzZWxmLmNvbHVtbiA9IHNlbGYuZGF0YWZyYW1lLmNvbHVtbnMuc2l6ZQog
ICAgICAgICAgICAgICAgc2VsZi5kYXRhZnJhbWUuaW5kZXg9WydTYW1wbGVfJXMnJWkgZm9yIGkgaW4g
cmFuZ2Uoc2VsZi5yb3cpXQogICAgICAgICAgICAgICAgc2VsZi5kYXRhZnJhbWUuY29sdW1ucyA9IFsn
Rl8lcyclaSBmb3IgaSBpbiByYW5nZShzZWxmLmNvbHVtbildCiAgICAgICAgICAgICAgICBzZWxmLmRh
dGFsYWJlbCA9IGFycmF5WzosIDBdLmFzdHlwZShpbnQpCiAgICAgICAgICAgICAgICBzZWxmLmRhdGFf
c2FtcGxlX3B1cnBvc2UgPSBucC5hcnJheShbVHJ1ZV0gKiBzZWxmLnJvdykKICAgICAgICAgICAgZWxz
ZToKICAgICAgICAgICAgICAgIHdpdGggb3BlbihmaWxlKSBhcyBmOgogICAgICAgICAgICAgICAgICAg
IHJlY29yZCA9IGYucmVhZCgpLnN0cmlwKCkuc3BsaXQoJ0AnKVstMV0uc3BsaXQoJ1xuJylbMTpdCiAg
ICAgICAgICAgICAgICBhcnJheSA9IG5wLmFycmF5KFtpdGVtLnNwbGl0KCcsJykgZm9yIGl0ZW0gaW4g
cmVjb3JkXSkKICAgICAgICAgICAgICAgIHNlbGYuZGF0YWZyYW1lID0gcGQuRGF0YUZyYW1lKGFycmF5
WzosIDA6LTFdLCBkdHlwZT1mbG9hdCkKICAgICAgICAgICAgICAgIHNlbGYucm93ID0gc2VsZi5kYXRh
ZnJhbWUuaW5kZXguc2l6ZQogICAgICAgICAgICAgICAgc2VsZi5jb2x1bW4gPSBzZWxmLmRhdGFmcmFt
ZS5jb2x1bW5zLnNpemUKICAgICAgICAgICAgICAgIHNlbGYuZGF0YWZyYW1lLmluZGV4PVsnU2FtcGxl
XyVzJyVpIGZvciBpIGluIHJhbmdlKHNlbGYucm93KV0KICAgICAgICAgICAgICAgIHNlbGYuZGF0YWZy
YW1lLmNvbHVtbnMgPSBbJ0ZfJXMnJWkgZm9yIGkgaW4gcmFuZ2Uoc2VsZi5jb2x1bW4pXQogICAgICAg
ICAgICAgICAgbGFiZWwgPSBbXQogICAgICAgICAgICAgICAgZm9yIGkgaW4gYXJyYXlbOiwgLTFdOgog
ICAgICAgICAgICAgICAgICAgIGlmIGkgPT0gJ3llcyc6CiAgICAgICAgICAgICAgICAgICAgICAgIGxh
YmVsLmFwcGVuZCgxKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAg
ICAgIGxhYmVsLmFwcGVuZCgwKQogICAgICAgICAgICAgICAgc2VsZi5kYXRhbGFiZWwgPSBucC5hcnJh
eShsYWJlbCkKICAgICAgICAgICAgICAgIHNlbGYuZGF0YV9zYW1wbGVfcHVycG9zZSA9IG5wLmFycmF5
KFtUcnVlXSAqIHNlbGYucm93KQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAg
ICAgc2VsZi5lcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAg
cmV0dXJuIFRydWUKCiAgICBkZWYgbG9hZF9kYXRhX2Zyb21fZGVzY3JpcHRvcihzZWxmLCBvYmpEZXNj
cmlwdG9yKToKICAgICAgICBkYXRhID0gY29weS5kZWVwY29weShvYmpEZXNjcmlwdG9yLmVuY29kaW5n
X2FycmF5KQogICAgICAgIHRyeToKICAgICAgICAgICAgY29sdW1uTmFtZSA9IGRhdGFbMCwgMjpdCiAg
ICAgICAgICAgIGluZGV4TmFtZSA9IGRhdGFbMTosIDBdCiAgICAgICAgICAgIHNlbGYuZGF0YWZyYW1l
ID0gcGQuRGF0YUZyYW1lKGRhdGFbMTosIDI6XS5hc3R5cGUoZmxvYXQpLCBpbmRleD1pbmRleE5hbWUs
IGNvbHVtbnM9Y29sdW1uTmFtZSkKICAgICAgICAgICAgc2VsZi5yb3cgPSBzZWxmLmRhdGFmcmFtZS5p
bmRleC5zaXplCiAgICAgICAgICAgIHNlbGYuY29sdW1uID0gc2VsZi5kYXRhZnJhbWUuY29sdW1ucy5z
aXplCiAgICAgICAgICAgIHNlbGYuZGF0YWxhYmVsID0gZGF0YVsxOiwgMV0uYXN0eXBlKGludCkKICAg
ICAgICAgICAgc2VsZi5kYXRhX3NhbXBsZV9wdXJwb3NlID0gb2JqRGVzY3JpcHRvci5zYW1wbGVfcHVy
cG9zZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5lcnJvcl9t
c2cgPSBzdHIoZSkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgcmV0dXJuIFRydWUKCiAg
ICBkZWYgbG9hZF9kYXRhX2Zyb21fZGltZW5zaW9uX3JlZHVjdGlvbihzZWxmLCBvYmpEYXRhKToKICAg
ICAgICB0cnk6CiAgICAgICAgICAgIGRhdGEgPSBjb3B5LmRlZXBjb3B5KG9iakRhdGEpCiAgICAgICAg
ICAgIGNvbHVtbk5hbWUgPSBbJ1BDJXMnICUoaSsxKSBmb3IgaSBpbiByYW5nZShkYXRhLmRpbWVuc2lv
bl9yZWR1Y3Rpb25fcmVzdWx0LnNoYXBlWzFdKV0KICAgICAgICAgICAgaW5kZXhOYW1lID0gZGF0YS5k
YXRhZnJhbWUuaW5kZXgKICAgICAgICAgICAgc2VsZi5kYXRhZnJhbWUgPSBwZC5EYXRhRnJhbWUoZGF0
YS5kaW1lbnNpb25fcmVkdWN0aW9uX3Jlc3VsdCwgaW5kZXg9aW5kZXhOYW1lLCBjb2x1bW5zPWNvbHVt
bk5hbWUpCiAgICAgICAgICAgIHNlbGYucm93ID0gc2VsZi5kYXRhZnJhbWUuaW5kZXguc2l6ZQogICAg
ICAgICAgICBzZWxmLmNvbHVtbiA9IHNlbGYuZGF0YWZyYW1lLmNvbHVtbnMuc2l6ZQogICAgICAgICAg
ICBzZWxmLmRhdGFsYWJlbCA9IGRhdGEuZGF0YWxhYmVsCiAgICAgICAgICAgIHNlbGYuZGF0YV9zYW1w
bGVfcHVycG9zZSA9IGRhdGEuZGF0YV9zYW1wbGVfcHVycG9zZQogICAgICAgICAgICByZXR1cm4gVHJ1
ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cg
PSBzdHIoZSkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlICAgICAgIAogICAgCiAgICBkZWYgbG9hZF9k
YXRhX2Zyb21fc2VsZWN0aW9uKHNlbGYsIG9ialNlbGVjdGlvbik6CiAgICAgICAgdHJ5OgogICAgICAg
ICAgICBzZWxmLmRhdGFmcmFtZSA9IGNvcHkuZGVlcGNvcHkob2JqU2VsZWN0aW9uLmZlYXR1cmVfc2Vs
ZWN0aW9uX2RhdGEpCiAgICAgICAgICAgIGRlbCBzZWxmLmRhdGFmcmFtZVsnTGFiZWxzJ10KICAgICAg
ICAgICAgc2VsZi5kYXRhbGFiZWwgPSBjb3B5LmNvcHkob2JqU2VsZWN0aW9uLmRhdGFsYWJlbCkKICAg
ICAgICAgICAgc2VsZi5kYXRhX3NhbXBsZV9wdXJwb3NlID0gY29weS5jb3B5KG9ialNlbGVjdGlvbi5k
YXRhX3NhbXBsZV9wdXJwb3NlKQogICAgICAgICAgICBzZWxmLnJvdyA9IHNlbGYuZGF0YWZyYW1lLnZh
bHVlcy5zaGFwZVswXQogICAgICAgICAgICBzZWxmLmNvbHVtbiA9IHNlbGYuZGF0YWZyYW1lLnZhbHVl
cy5zaGFwZVsxXQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5l
cnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgcmV0dXJuIFRy
dWUKCiAgICBkZWYgbG9hZF9kYXRhX2Zyb21fbm9ybWFsaXphdGlvbihzZWxmLCBvYmpTZWxlY3Rpb24p
OgogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5kYXRhZnJhbWUgPSBjb3B5LmRlZXBjb3B5KG9i
alNlbGVjdGlvbi5mZWF0dXJlX25vcm1hbGl6YXRpb25fZGF0YSkKICAgICAgICAgICAgZGVsIHNlbGYu
ZGF0YWZyYW1lWydMYWJlbHMnXQogICAgICAgICAgICBzZWxmLmRhdGFsYWJlbCA9IGNvcHkuY29weShv
YmpTZWxlY3Rpb24uZGF0YWxhYmVsKQogICAgICAgICAgICBzZWxmLmRhdGFfc2FtcGxlX3B1cnBvc2Ug
PSBjb3B5LmNvcHkob2JqU2VsZWN0aW9uLmRhdGFfc2FtcGxlX3B1cnBvc2UpCiAgICAgICAgICAgIHNl
bGYucm93ID0gc2VsZi5kYXRhZnJhbWUudmFsdWVzLnNoYXBlWzBdCiAgICAgICAgICAgIHNlbGYuY29s
dW1uID0gc2VsZi5kYXRhZnJhbWUudmFsdWVzLnNoYXBlWzFdCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlv
biBhcyBlOgogICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9IHN0cihlKQogICAgICAgICAgICByZXR1
cm4gRmFsc2UKICAgICAgICByZXR1cm4gVHJ1ZQoKICAgIGRlZiBrbWVhbnMoc2VsZik6CiAgICAgICAg
dHJ5OgogICAgICAgICAgICBuY2x1c3RlcnMgPSBzZWxmLmt3WyduY2x1c3RlcnMnXQogICAgICAgICAg
ICBpZiBub3Qgc2VsZi5kYXRhZnJhbWUgaXMgTm9uZToKICAgICAgICAgICAgICAgIHNlbGYuY2x1c3Rl
cl9yZXN1bHQgPSBLTWVhbnMobl9jbHVzdGVycz1uY2x1c3RlcnMpLmZpdF9wcmVkaWN0KHNlbGYuZGF0
YWZyYW1lLnZhbHVlcykKICAgICAgICAgICAgICAgIHNlbGYuY2x1c3Rlcl9wbG90X2RhdGEsIG9rID0g
c2VsZi50X3NuZSgyKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToK
ICAgICAgICAgICAgICAgIHNlbGYuZXJyb3JfbXNnID0gJ0RhdGEgaXMgbnVsbC4nCiAgICAgICAgICAg
ICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAg
IHNlbGYuZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBN
aW5pQmF0Y2hLTWVhbnMoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBuY2x1c3RlcnMgPSBz
ZWxmLmt3WyduY2x1c3RlcnMnXQogICAgICAgICAgICBpZiBub3Qgc2VsZi5kYXRhZnJhbWUgaXMgTm9u
ZToKICAgICAgICAgICAgICAgIHNlbGYuY2x1c3Rlcl9yZXN1bHQgPSBNaW5pQmF0Y2hLTWVhbnMobl9j
bHVzdGVycz1uY2x1c3RlcnMpLmZpdF9wcmVkaWN0KHNlbGYuZGF0YWZyYW1lLnZhbHVlcykKICAgICAg
ICAgICAgICAgIHNlbGYuY2x1c3Rlcl9wbG90X2RhdGEsIG9rID0gc2VsZi50X3NuZSgyKQogICAgICAg
ICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYu
ZXJyb3JfbXNnID0gJ0RhdGEgaXMgbnVsbC4nCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKICAg
ICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYuZXJyb3JfbXNnID0gc3Ry
KGUpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBNQ0woc2VsZik6CiAgICAgICAgdHJ5
OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5kYXRhZnJhbWUgaXMgTm9uZToKICAgICAgICAgICAgICAg
IHNlbGYuY2x1c3Rlcl9yZXN1bHQgPSBNYXJrdkNsdXN0ZXIoc2VsZi5kYXRhZnJhbWUudmFsdWVzLCBp
bnQoc2VsZi5rd1snZXhwYW5kX2ZhY3RvciddKSwgc2VsZi5rd1snaW5mbGF0ZV9mYWN0b3InXSwgc2Vs
Zi5rd1snbXVsdGlwbHlfZmFjdG9yJ10sIDIwMDApLmNsdXN0ZXJfYXJyYXkKICAgICAgICAgICAgICAg
IHNlbGYuY2x1c3Rlcl9wbG90X2RhdGEsIG9rID0gc2VsZi50X3NuZSgyKSAgICAgICAgICAgICAgICAK
ICAgICAgICAgICAgICAgIGlmIG9rIGFuZCBsZW4oc2VsZi5jbHVzdGVyX3Jlc3VsdCkgPT0gbGVuKHNl
bGYuZGF0YWZyYW1lKToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAg
ICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UgICAgICAgICAgICAgICAgCiAg
ICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9ICdEYXRhIGlzIG51
bGwuJwogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBh
cyBlOgogICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9IHN0cihlKQogICAgICAgICAgICByZXR1cm4g
RmFsc2UKCiAgICBkZWYgR00oc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBuY2x1c3RlcnMg
PSBzZWxmLmt3WyduY2x1c3RlcnMnXQogICAgICAgICAgICBpZiBub3Qgc2VsZi5kYXRhZnJhbWUgaXMg
Tm9uZToKICAgICAgICAgICAgICAgIHNlbGYuY2x1c3Rlcl9yZXN1bHQgPSBHYXVzc2lhbk1peHR1cmUo
bl9jb21wb25lbnRzPW5jbHVzdGVycykuZml0X3ByZWRpY3Qoc2VsZi5kYXRhZnJhbWUudmFsdWVzKQog
ICAgICAgICAgICAgICAgc2VsZi5jbHVzdGVyX3Bsb3RfZGF0YSwgb2sgPSBzZWxmLnRfc25lKDIpCiAg
ICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAg
c2VsZi5lcnJvcl9tc2cgPSAnRGF0YSBpcyBudWxsLicKICAgICAgICAgICAgICAgIHJldHVybiBGYWxz
ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cg
PSBzdHIoZSkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIEFnZ2xvbWVyYXRpdmUoc2Vs
Zik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBuY2x1c3RlcnMgPSBzZWxmLmt3WyduY2x1c3RlcnMn
XQogICAgICAgICAgICBpZiBub3Qgc2VsZi5kYXRhZnJhbWUgaXMgTm9uZToKICAgICAgICAgICAgICAg
IHNlbGYuY2x1c3Rlcl9yZXN1bHQgPSBBZ2dsb21lcmF0aXZlQ2x1c3RlcmluZyhuX2NsdXN0ZXJzPW5j
bHVzdGVycykuZml0X3ByZWRpY3Qoc2VsZi5kYXRhZnJhbWUudmFsdWVzKQogICAgICAgICAgICAgICAg
c2VsZi5jbHVzdGVyX3Bsb3RfZGF0YSwgb2sgPSBzZWxmLnRfc25lKDIpCiAgICAgICAgICAgICAgICBy
ZXR1cm4gVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cg
PSAnRGF0YSBpcyBudWxsLicKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2Vw
dCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSBzdHIoZSkKICAgICAg
ICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIFNwZWN0cmFsKHNlbGYpOgogICAgICAgIHRyeToKICAg
ICAgICAgICAgbmNsdXN0ZXJzID0gc2VsZi5rd1snbmNsdXN0ZXJzJ10KICAgICAgICAgICAgaWYgbm90
IHNlbGYuZGF0YWZyYW1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBzZWxmLmNsdXN0ZXJfcmVzdWx0
ID0gU3BlY3RyYWxDbHVzdGVyaW5nKG5fY2x1c3RlcnM9bmNsdXN0ZXJzKS5maXRfcHJlZGljdChzZWxm
LmRhdGFmcmFtZS52YWx1ZXMpCiAgICAgICAgICAgICAgICBzZWxmLmNsdXN0ZXJfcGxvdF9kYXRhLCBv
ayA9IHNlbGYudF9zbmUoMikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVs
c2U6CiAgICAgICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9ICdEYXRhIGlzIG51bGwuJwogICAgICAg
ICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAg
ICAgICBzZWxmLmVycm9yX21zZyA9IHN0cihlKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBk
ZWYgaGNsdXN0ZXIoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5kYXRh
ZnJhbWUgaXMgTm9uZToKICAgICAgICAgICAgICAgIGRpc01hdCA9IHNjaC5kaXN0YW5jZS5wZGlzdChz
ZWxmLmRhdGFmcmFtZS52YWx1ZXMsICdldWNsaWRlYW4nKQogICAgICAgICAgICAgICAgWiA9IHNjaC5s
aW5rYWdlKGRpc01hdCwgbWV0aG9kPSdhdmVyYWdlJykKICAgICAgICAgICAgICAgIHNlbGYuY2x1c3Rl
cl9yZXN1bHQgPSBzY2guZmNsdXN0ZXIoWiwgMSwgJ2luY29uc2lzdGVudCcpCiAgICAgICAgICAgICAg
ICBzZWxmLmNsdXN0ZXJfcGxvdF9kYXRhLCBvayA9IHNlbGYudF9zbmUoMikKICAgICAgICAgICAgICAg
IHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzZWxmLmVycm9yX21z
ZyA9ICdEYXRhIGlzIG51bGwuJwogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgZXhj
ZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9IHN0cihlKQogICAg
ICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgQVBDKHNlbGYpOgogICAgICAgIHRyeToKICAgICAg
ICAgICAgaWYgbm90IHNlbGYuZGF0YWZyYW1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBzZWxmLmNs
dXN0ZXJfcmVzdWx0ID0gQWZmaW5pdHlQcm9wYWdhdGlvbigpLmZpdF9wcmVkaWN0KHNlbGYuZGF0YWZy
YW1lLnZhbHVlcykKICAgICAgICAgICAgICAgIHNlbGYuY2x1c3Rlcl9wbG90X2RhdGEsIG9rID0gc2Vs
Zi50X3NuZSgyKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAg
ICAgICAgICAgICAgIHNlbGYuZXJyb3JfbXNnID0gJ0RhdGEgaXMgbnVsbC4nCiAgICAgICAgICAgICAg
ICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNl
bGYuZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBtZWFu
c2hpZnQoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5kYXRhZnJhbWUg
aXMgTm9uZToKICAgICAgICAgICAgICAgIGJhbmR3aWR0aCA9IGVzdGltYXRlX2JhbmR3aWR0aChzZWxm
LmRhdGFmcmFtZSkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBzZWxmLmNs
dXN0ZXJfcmVzdWx0ID0gTWVhblNoaWZ0KGJhbmR3aWR0aD1iYW5kd2lkdGgsIGJpbl9zZWVkaW5nPVRy
dWUpLmZpdF9wcmVkaWN0KHNlbGYuZGF0YWZyYW1lLnZhbHVlcykgICAgICAgICAgICAgICAgICAgIAog
ICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHNl
bGYuY2x1c3Rlcl9yZXN1bHQgPSBucC56ZXJvcyhsZW4oc2VsZi5kYXRhZnJhbWUpKSAgICAgICAgICAg
ICAgICAgICAgCiAgICAgICAgICAgICAgICBzZWxmLmNsdXN0ZXJfcGxvdF9kYXRhLCBvayA9IHNlbGYu
dF9zbmUoMikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAg
ICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9ICdEYXRhIGlzIG51bGwuJwogICAgICAgICAgICAgICAg
cmV0dXJuIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxm
LmVycm9yX21zZyA9IHN0cihlKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgREJTQ0FO
KHNlbGYpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZGF0YWZyYW1lIGlzIE5v
bmU6CiAgICAgICAgICAgICAgICBkYXRhID0gU3RhbmRhcmRTY2FsZXIoKS5maXRfdHJhbnNmb3JtKHNl
bGYuZGF0YWZyYW1lLnZhbHVlcykKICAgICAgICAgICAgICAgIHNlbGYuY2x1c3Rlcl9yZXN1bHQgPSBE
QlNDQU4oKS5maXRfcHJlZGljdChkYXRhKSAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5j
bHVzdGVyX3Bsb3RfZGF0YSwgb2sgPSBzZWxmLnRfc25lKDIpCiAgICAgICAgICAgICAgICByZXR1cm4g
VHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSAnRGF0
YSBpcyBudWxsLicKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNl
cHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAg
cmV0dXJuIEZhbHNlCgogICAgZGVmIGV4cG9ydF9jbHVzdGVyX3RleHQoc2VsZik6CiAgICAgICAgdHJ5
OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5jbHVzdGVyX3Jlc3VsdCBpcyBOb25lOgogICAgICAgICAg
ICAgICAgdGV4dCA9ICdTYW1wbGVOYW1lXHRDbHVzdGVyXG49PT09PT09PT09PT09PT09PT09PT09PT09
PT09PT1cbicKICAgICAgICAgICAgICAgIGZvciBpLCBuYW1lIGluIGVudW1lcmF0ZShsaXN0KHNlbGYu
ZGF0YWZyYW1lLmluZGV4KSk6CiAgICAgICAgICAgICAgICAgICAgdGV4dCArPSAnJXNcdCVzXG4nICUg
KG5hbWUsIHNlbGYuY2x1c3Rlcl9yZXN1bHRbaV0pCiAgICAgICAgICAgICAgICByZXR1cm4gdGV4dAog
ICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSBz
dHIoZSkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAiIiIKICAgIGRlZiBnZW5lcmF0ZV9zcG90
X2RhdGEoc2VsZiwgY19sYWJlbCwgcmRfZGF0YSk6CiAgICAgICAgc3BvdHMgPSBbe31dCiAgICAgICAg
Y29sb3IgPSB7MDogMCwgMTogNiwgMjogNywgMzogOCwgNDogMSwgNTogMiwgNjogMywgNzogNCwgODog
NX0KICAgICAgICBpZiBsZW4oY19sYWJlbCkgIT0gbGVuKHJkX2RhdGEpOgogICAgICAgICAgICBzZWxm
LmVycm9yX21zZyA9ICdQbG90IGZhaWxlZC4nCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc3BvdHMg
PSBbCiAgICAgICAgICAgICAgICB7J3Bvcyc6IHJkX2RhdGFbaV0sICdkYXRhJzogMSwgJ2JydXNoJzog
cGcuaW50Q29sb3IoY29sb3JbY19sYWJlbFtpXSAlIDldKSwgJ3N5bWJvbCc6IGNfbGFiZWxbaV0gJSAx
MiwKICAgICAgICAgICAgICAgICAnc2l6ZSc6IDE1fSBmb3IgaSBpbiByYW5nZShsZW4oY19sYWJlbCkp
XQogICAgICAgIHJldHVybiBzcG90cwogICAgIiIiCgogICAgZGVmIGdlbmVyYXRlX3Bsb3RfZGF0YShz
ZWxmLCBsYWJlbCwgcmRfZGF0YSk6CiAgICAgICAgcGxvdF9kYXRhID0gW10KICAgICAgICBjbHVzdGVy
cyA9IHNvcnRlZChzZXQobGFiZWwpKQogICAgICAgIGZvciBjIGluIGNsdXN0ZXJzOgogICAgICAgICAg
ICBwbG90X2RhdGEuYXBwZW5kKFtjLCByZF9kYXRhW25wLndoZXJlKGxhYmVsID09IGMpXV0pCiAgICAg
ICAgcmV0dXJuIHBsb3RfZGF0YQoKICAgIGRlZiB0X3NuZShzZWxmLCBuX2NvbXBvbmVudHM9Mik6CiAg
ICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgc2VsZi5kYXRhZnJhbWUgaXMgTm9uZTogICAgICAg
ICAgICAKICAgICAgICAgICAgICAgIGlmIG5fY29tcG9uZW50cyA+PSBzZWxmLmRhdGFmcmFtZS5zaGFw
ZVsxXToKICAgICAgICAgICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9ICdUaGUgcmVkdWNlZCBkaW1l
bnNpb24gbnVtYmVyIGlzIG91dCBvZiByYW5nZS4nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5v
bmUsIEZhbHNlICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZF9kYXRhID0gVFNORShuX2NvbXBv
bmVudHM9bl9jb21wb25lbnRzLCBtZXRob2Q9J2V4YWN0JywgbGVhcm5pbmdfcmF0ZT0xMDApLmZpdF90
cmFuc2Zvcm0oc2VsZi5kYXRhZnJhbWUudmFsdWVzKSAgICAgICAgICAgIAogICAgICAgICAgICAgICAg
cmV0dXJuIHJkX2RhdGEsIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYu
ZXJyb3JfbXNnID0gJ0RhdGEgaXMgbnVsbC4nCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZSwgRmFs
c2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYuZXJyb3JfbXNn
ID0gc3RyKGUpCiAgICAgICAgICAgIHJldHVybiBOb25lLCBGYWxzZQoKICAgIGRlZiBQQ0Eoc2VsZiwg
bl9jb21wb25lbnRzPTIpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbm90IHNlbGYuZGF0YWZy
YW1lIGlzIE5vbmU6CiAgICAgICAgICAgICAgICBpZiBuX2NvbXBvbmVudHMgPj0gc2VsZi5kYXRhZnJh
bWUuc2hhcGVbMV06CiAgICAgICAgICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSAnVGhlIHJlZHVj
ZWQgZGltZW5zaW9uIG51bWJlciBpcyBvdXQgb2YgcmFuZ2UuJwogICAgICAgICAgICAgICAgICAgIHJl
dHVybiBOb25lLCBGYWxzZQogICAgICAgICAgICAgICAgcmRfZGF0YSA9IFBDQShuX2NvbXBvbmVudHM9
bl9jb21wb25lbnRzKS5maXRfdHJhbnNmb3JtKHNlbGYuZGF0YWZyYW1lLnZhbHVlcykgICAgICAgICAg
ICAKICAgICAgICAgICAgICAgIHJldHVybiByZF9kYXRhLCBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAg
ICAgICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9ICdEYXRhIGlzIG51bGwuJwogICAgICAgICAgICAg
ICAgcmV0dXJuIE5vbmUsIEZhbHNlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAg
ICAgICBzZWxmLmVycm9yX21zZyA9IHN0cihlKQogICAgICAgICAgICByZXR1cm4gTm9uZSwgRmFsc2UK
CiAgICBkZWYgTERBKHNlbGYsIG5fY29tcG9uZW50cz0yKToKICAgICAgICB0cnk6CiAgICAgICAgICAg
IGlmIG5vdCBzZWxmLmRhdGFmcmFtZSBpcyBOb25lOgogICAgICAgICAgICAgICAgaWYgbl9jb21wb25l
bnRzID49IHNlbGYuZGF0YWZyYW1lLnNoYXBlWzFdOgogICAgICAgICAgICAgICAgICAgIHNlbGYuZXJy
b3JfbXNnID0gJ1RoZSByZWR1Y2VkIGRpbWVuc2lvbiBudW1iZXIgaXMgb3V0IG9mIHJhbmdlLicKICAg
ICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZSwgRmFsc2UKICAgICAgICAgICAgICAgIGxkYSA9IExh
dGVudERpcmljaGxldEFsbG9jYXRpb24obl9jb21wb25lbnRzPW5fY29tcG9uZW50cykuZml0KHNlbGYu
ZGF0YWZyYW1lLnZhbHVlcywgc2VsZi5kYXRhbGFiZWwpCiAgICAgICAgICAgICAgICByZF9kYXRhID0g
bGRhLnRyYW5zZm9ybShzZWxmLmRhdGFmcmFtZS52YWx1ZXMpCiAgICAgICAgICAgICAgICByZXR1cm4g
cmRfZGF0YSwgVHJ1ZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5lcnJvcl9t
c2cgPSAnRGF0YSBpcyBudWxsLicKICAgICAgICAgICAgICAgIHJldHVybiBOb25lLCBGYWxzZQogICAg
ICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSBzdHIo
ZSkKICAgICAgICAgICAgcmV0dXJuIE5vbmUsIEZhbHNlCgogICAgZGVmIHNhdmVfZGF0YShzZWxmLCBm
aWxlLCBhbmFseXNpc190eXBlKToKICAgICAgICBpZiBhbmFseXNpc190eXBlID09ICdDbHVzdGVyIGFs
Z29yaXRobXMnOgogICAgICAgICAgICBpZiBub3Qgc2VsZi5jbHVzdGVyX3Jlc3VsdCBpcyBOb25lOgog
ICAgICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGUsICd3JywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoK
ICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCdTYW1wbGVOYW1lXHRDbHVzdGVyXG4nKQogICAgICAg
ICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihzZWxmLmNsdXN0ZXJfcmVzdWx0KSk6CiAgICAg
ICAgICAgICAgICAgICAgICAgIGYud3JpdGUoJyVzXHQlc1xuJyAlKHNlbGYuZGF0YWZyYW1lLmluZGV4
W2ldLCBzZWxmLmNsdXN0ZXJfcmVzdWx0W2ldKSkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAg
ICAgIFFNZXNzYWdlQm94LmNyaXRpY2FsKHNlbGYsICdFcnJvcicsICdFbXB0eSBkYXRhIScsIFFNZXNz
YWdlQm94Lk9rIHwgUU1lc3NhZ2VCb3guTm8sIFFNZXNzYWdlQm94Lk9rKQogICAgICAgIGVsc2U6CiAg
ICAgICAgICAgIGlmIG5vdCBzZWxmLmRpbWVuc2lvbl9yZWR1Y3Rpb25fcmVzdWx0IGlzIE5vbmU6CiAg
ICAgICAgICAgICAgICBucC5zYXZldHh0KGZpbGUsIHNlbGYuZGltZW5zaW9uX3JlZHVjdGlvbl9yZXN1
bHQsIGZtdD0nJWYnLCBkZWxpbWl0ZXI9J1x0JykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAg
ICAgIFFNZXNzYWdlQm94LmNyaXRpY2FsKHNlbGYsICdFcnJvcicsICdFbXB0eSBkYXRhIScsIFFNZXNz
YWdlQm94Lk9rIHwgUU1lc3NhZ2VCb3guTm8sIFFNZXNzYWdlQm94Lk9rKQoKICAgICIiIiBmZWF0dXJl
IHNlbGVjdGlvbiAvIG5vcm1hbGl6YXRpb24gIiIiCiAgICBkZWYgQ0hJMihzZWxmKToKICAgICAgICB0
cnk6CiAgICAgICAgICAgIGJpbkJveCA9IFsxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMF0KICAg
ICAgICAgICAgbGFiZWxzID0gc2VsZi5kYXRhbGFiZWwudG9saXN0KCkKICAgICAgICAgICAgZGF0YSA9
IG5wLmFycmF5KHNlbGYuZGF0YWZyYW1lLnZhbHVlcykKICAgICAgICAgICAgZmVhdHVyZXMgPSBzZWxm
LmRhdGFmcmFtZS5jb2x1bW5zCgogICAgICAgICAgICBpZiBkYXRhLnNoYXBlWzBdIDwgNSBvciBkYXRh
LnNoYXBlWzFdIDwgMjoKICAgICAgICAgICAgICAgIHNlbGYuZXJyb3JfbXNnID0gJ1NhbXBsZSBudW1i
ZXIgaXMgdHdvIGxlc3MnCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICAgICAgICAgIHNh
bXBsZU51bWJlciA9IGxlbihkYXRhKQogICAgICAgICAgICBsYWJlbENsYXNzID0gc2V0KGxhYmVscykK
CiAgICAgICAgICAgIG15RmVhID0ge30KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGZlYXR1
cmVzKSk6CiAgICAgICAgICAgICAgICBhcnJheSA9IGRhdGFbOiwgaV0KICAgICAgICAgICAgICAgIG5l
d0FycmF5ID0gbGlzdChwZC5jdXQoYXJyYXksIGxlbihiaW5Cb3gpLCBsYWJlbHM9YmluQm94KSkKICAg
ICAgICAgICAgICAgIGJpbkJveENsYXNzID0gc2V0KG5ld0FycmF5KQogICAgICAgICAgICAgICAgbXlP
YnNlcnZhdGlvbiA9IHt9CiAgICAgICAgICAgICAgICBmb3IgaiBpbiByYW5nZShsZW4obGFiZWxzKSk6
CiAgICAgICAgICAgICAgICAgICAgbXlPYnNlcnZhdGlvbltzdHIobGFiZWxzW2pdKSArIHN0cihuZXdB
cnJheVtqXSldID0gbXlPYnNlcnZhdGlvbi5nZXQoc3RyKGxhYmVsc1tqXSkgKyBzdHIobmV3QXJyYXlb
al0pLCAwKSArIDEKICAgICAgICAgICAgICAgIG15RXhwZWN0ID0ge30KICAgICAgICAgICAgICAgIGZv
ciBqIGluIGxhYmVsQ2xhc3M6CiAgICAgICAgICAgICAgICAgICAgZm9yIGsgaW4gYmluQm94OgogICAg
ICAgICAgICAgICAgICAgICAgICBteUV4cGVjdFtzdHIoaikgKyBzdHIoayldID0gbGFiZWxzLmNvdW50
KGopICogbmV3QXJyYXkuY291bnQoaykgLyBzYW1wbGVOdW1iZXIKICAgICAgICAgICAgICAgIGNoaVZh
bHVlID0gMAogICAgICAgICAgICAgICAgZm9yIGogaW4gbGFiZWxDbGFzczoKICAgICAgICAgICAgICAg
ICAgICBmb3IgayBpbiBiaW5Cb3hDbGFzczoKICAgICAgICAgICAgICAgICAgICAgICAgY2hpVmFsdWUg
PSBjaGlWYWx1ZSArIHBvdygoKG15T2JzZXJ2YXRpb24uZ2V0KHN0cihqKSArIHN0cihrKSwgMCkpIC0g
bXlFeHBlY3QuZ2V0KHN0cihqKSArIHN0cihrKSwgMCkpLAogICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAyKSAvIG15RXhwZWN0W3N0cihqKSArIHN0cihrKV0KICAgICAg
ICAgICAgICAgIG15RmVhW2ZlYXR1cmVzW2ldXSA9IGNoaVZhbHVlCiAgICAgICAgICAgIHJlcyA9IFtd
CiAgICAgICAgICAgIGZvciBrZXkgaW4gc29ydGVkKG15RmVhLml0ZW1zKCksIGtleT1sYW1iZGEgaXRl
bTogaXRlbVsxXSwgcmV2ZXJzZT1UcnVlKToKICAgICAgICAgICAgICAgIHJlcy5hcHBlbmQoW2tleVsw
XSwgJ3swOi4zZn0nLmZvcm1hdChteUZlYVtrZXlbMF1dKV0pCiAgICAgICAgICAgIHNlbGYuZmVhdHVy
ZV9zZWxlY3Rpb25fcmVzdWx0ID0gcGQuRGF0YUZyYW1lKHJlcywgY29sdW1ucz1bJ1NhbXBsZU5hbWUn
LCAnVmFsdWVzJ10pCiAgICAgICAgICAgIHNlbGVjdGVkX2ZlYXR1cmVfbnVtYmVyID0gc2VsZi5rd1sn
ZmVhdHVyZV9udW1iZXInXSBpZiBzZWxmLmt3WydmZWF0dXJlX251bWJlciddIDw9IGRhdGEuc2hhcGVb
MV0gZWxzZSBkYXRhLnNoYXBlWzFdCiAgICAgICAgICAgIHNlbGYuZmVhdHVyZV9zZWxlY3Rpb25fZGF0
YSA9IHNlbGYuZGF0YWZyYW1lLmxvY1s6LCBzZWxmLmZlYXR1cmVfc2VsZWN0aW9uX3Jlc3VsdC5TYW1w
bGVOYW1lWzpzZWxlY3RlZF9mZWF0dXJlX251bWJlcl1dCiAgICAgICAgICAgIHNlbGYuZmVhdHVyZV9z
ZWxlY3Rpb25fZGF0YS5pbnNlcnQoMCwgJ0xhYmVscycsIHNlbGYuZGF0YWxhYmVsKQogICAgICAgICAg
ICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2Vs
Zi5lcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgZGVmIGNhbFBy
b2Ioc2VsZiwgYXJyYXkpOgogICAgICAgIG15UHJvYiA9IHt9CiAgICAgICAgbXlDbGFzcyA9IHNldChh
cnJheSkKICAgICAgICBmb3IgaSBpbiBteUNsYXNzOgogICAgICAgICAgICBteVByb2JbaV0gPSBhcnJh
eS5jb3VudChpKSAvIGxlbihhcnJheSkKICAgICAgICByZXR1cm4gbXlQcm9iCgogICAgZGVmIGpvaW50
UHJvYihzZWxmLCBuZXdBcnJheSwgbGFiZWxzKToKICAgICAgICBteUpvaW50UHJvYiA9IHt9CiAgICAg
ICAgZm9yIGkgaW4gcmFuZ2UobGVuKGxhYmVscykpOgogICAgICAgICAgICBteUpvaW50UHJvYltzdHIo
bmV3QXJyYXlbaV0pICsgJy0nICsgc3RyKGxhYmVsc1tpXSldID0gbXlKb2ludFByb2IuZ2V0KHN0cihu
ZXdBcnJheVtpXSkgKyAnLScgKyBzdHIobGFiZWxzW2ldKSwgMCkgKyAxCgogICAgICAgIGZvciBrZXkg
aW4gbXlKb2ludFByb2I6CiAgICAgICAgICAgIG15Sm9pbnRQcm9iW2tleV0gPSBteUpvaW50UHJvYltr
ZXldIC8gbGVuKGxhYmVscykKICAgICAgICByZXR1cm4gbXlKb2ludFByb2IKCiAgICBkZWYgSUcoc2Vs
Zik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBiaW5Cb3ggPSBbMSwgMiwgMywgNCwgNSwgNiwgNywg
OCwgOSwgMTBdCiAgICAgICAgICAgIGxhYmVscyA9IHNlbGYuZGF0YWxhYmVsLnRvbGlzdCgpCiAgICAg
ICAgICAgIGRhdGEgPSBucC5hcnJheShzZWxmLmRhdGFmcmFtZS52YWx1ZXMpCiAgICAgICAgICAgIGZl
YXR1cmVzID0gc2VsZi5kYXRhZnJhbWUuY29sdW1ucwoKICAgICAgICAgICAgaWYgZGF0YS5zaGFwZVsw
XSA8IDUgb3IgZGF0YS5zaGFwZVsxXSA8IDI6CiAgICAgICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9
ICdTYW1wbGUgbnVtYmVyIGlzIHR3byBsZXNzJwogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgog
ICAgICAgICAgICBwcm9iWSA9IHNlbGYuY2FsUHJvYihsYWJlbHMpCgogICAgICAgICAgICBteUZlYSA9
IHt9CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihmZWF0dXJlcykpOgogICAgICAgICAgICAg
ICAgYXJyYXkgPSBkYXRhWzosIGldCiAgICAgICAgICAgICAgICBuZXdBcnJheSA9IGxpc3QocGQuY3V0
KGFycmF5LCBsZW4oYmluQm94KSwgbGFiZWxzPSBiaW5Cb3gpKQogICAgICAgICAgICAgICAgYmluQm94
Q2xhc3MgPSBzZXQobmV3QXJyYXkpCgogICAgICAgICAgICAgICAgcHJvYlggPSBzZWxmLmNhbFByb2Io
bmV3QXJyYXkpCiAgICAgICAgICAgICAgICBwcm9iWFkgPSBzZWxmLmpvaW50UHJvYihuZXdBcnJheSwg
bGFiZWxzKQogICAgICAgICAgICAgICAgSFggPSAtMSAqIHN1bShbcCAqIG1hdGgubG9nKHAsIDIpIGZv
ciBwIGluIHByb2JYLnZhbHVlcygpXSkKICAgICAgICAgICAgICAgIEhYWSA9IDAKICAgICAgICAgICAg
ICAgIGZvciB5IGluIHByb2JZLmtleXMoKToKICAgICAgICAgICAgICAgICAgICBmb3IgeCBpbiBwcm9i
WC5rZXlzKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cih4KSArICctJyArIHN0cih5KSBp
biBwcm9iWFk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBIWFkgPSBIWFkgKyAocHJvYlhZW3N0
cih4KSArICctJyArIHN0cih5KV0gKiBtYXRoLmxvZyhwcm9iWFlbc3RyKHgpICsgJy0nICsgc3RyKHkp
XSAvIHByb2JZW3ldLCAyKSkKICAgICAgICAgICAgICAgIG15RmVhW2ZlYXR1cmVzW2ldXSA9IEhYICsg
SFhZCgogICAgICAgICAgICByZXMgPSBbXQogICAgICAgICAgICBmb3Iga2V5IGluIHNvcnRlZChteUZl
YS5pdGVtcygpLCBrZXk9bGFtYmRhIGl0ZW06aXRlbVsxXSwgcmV2ZXJzZT1UcnVlKToKICAgICAgICAg
ICAgICAgIHJlcy5hcHBlbmQoW2tleVswXSwgJ3swOi4zZn0nLmZvcm1hdChteUZlYVtrZXlbMF1dKV0p
CiAgICAgICAgICAgIHNlbGYuZmVhdHVyZV9zZWxlY3Rpb25fcmVzdWx0ID0gcGQuRGF0YUZyYW1lKHJl
cywgY29sdW1ucz1bJ1NhbXBsZU5hbWUnLCAnVmFsdWVzJ10pCiAgICAgICAgICAgIHNlbGVjdGVkX2Zl
YXR1cmVfbnVtYmVyID0gc2VsZi5rd1snZmVhdHVyZV9udW1iZXInXSBpZiBzZWxmLmt3WydmZWF0dXJl
X251bWJlciddIDw9IGRhdGEuc2hhcGVbMV0gZWxzZSBkYXRhLnNoYXBlWzFdCiAgICAgICAgICAgIHNl
bGYuZmVhdHVyZV9zZWxlY3Rpb25fZGF0YSA9IHNlbGYuZGF0YWZyYW1lLmxvY1s6LCBzZWxmLmZlYXR1
cmVfc2VsZWN0aW9uX3Jlc3VsdC5TYW1wbGVOYW1lWzpzZWxlY3RlZF9mZWF0dXJlX251bWJlcl1dCiAg
ICAgICAgICAgIHNlbGYuZmVhdHVyZV9zZWxlY3Rpb25fZGF0YS5pbnNlcnQoMCwgJ0xhYmVscycsIHNl
bGYuZGF0YWxhYmVsKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRp
b24gYXMgZToKICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSBzdHIoZSkKICAgICAgICAgICAgcmV0
dXJuIEZhbHNlCgogICAgZGVmIENhbGN1bGF0ZV9Gc2NvcmUoc2VsZiwgYXJyYXksIGxhYmVscyk6CiAg
ICAgICAgdHJ5OgogICAgICAgICAgICBhcnJheV9wbyA9IFtdCiAgICAgICAgICAgIGFycmF5X25lID0g
W10KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGxhYmVscykpOgogICAgICAgICAgICAgICAg
aWYgbGFiZWxzW2ldID09IDE6CiAgICAgICAgICAgICAgICAgICAgYXJyYXlfcG8uYXBwZW5kKGFycmF5
W2ldKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBhcnJheV9uZS5hcHBl
bmQoYXJyYXlbaV0pCiAgICAgICAgICAgIG1lYW5fcG8gPSBzdW0oYXJyYXlfcG8pIC8gbGVuKGFycmF5
X3BvKQogICAgICAgICAgICBtZWFuX25lID0gc3VtKGFycmF5X25lKSAvIGxlbihhcnJheV9uZSkKICAg
ICAgICAgICAgbWVhbiA9IHN1bShhcnJheSkgLyBsZW4oYXJyYXkpCiAgICAgICAgICAgIHNjb3JlXzEg
PSAoKG1lYW5fcG8gLSBtZWFuKSAqKiAyICsgKG1lYW5fbmUgLSBtZWFuKSAqKiAyKQogICAgICAgICAg
ICBzY29yZV8yID0gc3VtKFsoaS1tZWFuX3BvKSAqKiAyIGZvciBpIGluIGFycmF5X3BvXSkgLyAobGVu
KGFycmF5X3BvKSAtIDEpCiAgICAgICAgICAgIHNjb3JlXzMgPSBzdW0oWyhpLW1lYW5fbmUpICoqIDIg
Zm9yIGkgaW4gYXJyYXlfbmVdKSAvIChsZW4oYXJyYXlfbmUpIC0gMSkKICAgICAgICAgICAgaWYgc2Nv
cmVfMiArIHNjb3JlXzMgPT0gMDoKICAgICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgICAgIGVs
c2U6CiAgICAgICAgICAgICAgICBmX3Njb3JlID0gc2NvcmVfMSAvIChzY29yZV8yICsgc2NvcmVfMykK
ICAgICAgICAgICAgICAgIHJldHVybiBmX3Njb3JlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBl
OgogICAgICAgICAgICByZXR1cm4gMAoKICAgIGRlZiBGU2NvcmUoc2VsZik6CiAgICAgICAgdHJ5Ogog
ICAgICAgICAgICBsYWJlbHMgPSBzZWxmLmRhdGFsYWJlbC50b2xpc3QoKQogICAgICAgICAgICBkYXRh
ID0gbnAuYXJyYXkoc2VsZi5kYXRhZnJhbWUudmFsdWVzKQogICAgICAgICAgICBmZWF0dXJlcyA9IHNl
bGYuZGF0YWZyYW1lLmNvbHVtbnMKCiAgICAgICAgICAgIGlmIGRhdGEuc2hhcGVbMF0gPCA1IG9yIGRh
dGEuc2hhcGVbMV0gPCAyOgogICAgICAgICAgICAgICAgc2VsZi5lcnJvcl9tc2cgPSAnU2FtcGxlIG51
bWJlciBpcyB0d28gbGVzcycKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICAgICAg
bXlGZWEgPSB7fQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShsZW4oZmVhdHVyZXMpKToKICAgICAg
ICAgICAgICAgIGFycmF5ID0gbGlzdChkYXRhWzosIGldKQogICAgICAgICAgICAgICAgbXlGZWFbZmVh
dHVyZXNbaV1dID0gc2VsZi5DYWxjdWxhdGVfRnNjb3JlKGFycmF5LCBsYWJlbHMpCgogICAgICAgICAg
ICByZXMgPSBbXQogICAgICAgICAgICBmb3Iga2V5IGluIHNvcnRlZChteUZlYS5pdGVtcygpLCBrZXk9
bGFtYmRhIGl0ZW06IGl0ZW1bMV0sIHJldmVyc2U9VHJ1ZSk6CiAgICAgICAgICAgICAgICByZXMuYXBw
ZW5kKFtrZXlbMF0sICd7MDouM2Z9Jy5mb3JtYXQobXlGZWFba2V5WzBdXSldKQogICAgICAgICAgICBz
ZWxmLmZlYXR1cmVfc2VsZWN0aW9uX3Jlc3VsdCA9IHBkLkRhdGFGcmFtZShyZXMsIGNvbHVtbnM9WydT
YW1wbGVOYW1lJywgJ1ZhbHVlcyddKQogICAgICAgICAgICBzZWxlY3RlZF9mZWF0dXJlX251bWJlciA9
IHNlbGYua3dbJ2ZlYXR1cmVfbnVtYmVyJ10gaWYgc2VsZi5rd1snZmVhdHVyZV9udW1iZXInXSA8PSBk
YXRhLnNoYXBlWzFdIGVsc2UgZGF0YS5zaGFwZVsxXQogICAgICAgICAgICBzZWxmLmZlYXR1cmVfc2Vs
ZWN0aW9uX2RhdGEgPSBzZWxmLmRhdGFmcmFtZS5sb2NbOiwgc2VsZi5mZWF0dXJlX3NlbGVjdGlvbl9y
ZXN1bHQuU2FtcGxlTmFtZVs6c2VsZWN0ZWRfZmVhdHVyZV9udW1iZXJdXQogICAgICAgICAgICBzZWxm
LmZlYXR1cmVfc2VsZWN0aW9uX2RhdGEuaW5zZXJ0KDAsICdMYWJlbHMnLCBzZWxmLmRhdGFsYWJlbCkK
ICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAg
ICAgICAgIHNlbGYuZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAg
IGRlZiBNSUMoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBiaW5Cb3ggPSBbMSwgMiwgMywg
NCwgNSwgNiwgNywgOCwgOSwgMTBdCiAgICAgICAgICAgIGxhYmVscyA9IHNlbGYuZGF0YWxhYmVsLnRv
bGlzdCgpCiAgICAgICAgICAgIGRhdGEgPSBucC5hcnJheShzZWxmLmRhdGFmcmFtZS52YWx1ZXMpCiAg
ICAgICAgICAgIGZlYXR1cmVzID0gc2VsZi5kYXRhZnJhbWUuY29sdW1ucwoKICAgICAgICAgICAgaWYg
ZGF0YS5zaGFwZVswXSA8IDUgb3IgZGF0YS5zaGFwZVsxXSA8IDI6CiAgICAgICAgICAgICAgICBzZWxm
LmVycm9yX21zZyA9ICdTYW1wbGUgbnVtYmVyIGlzIHR3byBsZXNzJwogICAgICAgICAgICAgICAgcmV0
dXJuIEZhbHNlCgogICAgICAgICAgICBwcm9iWSA9IHNlbGYuY2FsUHJvYihsYWJlbHMpCiAgICAgICAg
ICAgIG15RmVhID0ge30KICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKGZlYXR1cmVzKSk6CiAg
ICAgICAgICAgICAgICBhcnJheSA9IGRhdGFbOiwgaV0KICAgICAgICAgICAgICAgIG5ld0FycmF5ID0g
bGlzdChwZC5jdXQoYXJyYXksIGxlbihiaW5Cb3gpLCBsYWJlbHM9IGJpbkJveCkpCiAgICAgICAgICAg
ICAgICBiaW5Cb3hDbGFzcyA9IHNldChuZXdBcnJheSkKICAgICAgICAgICAgICAgIHByb2JYID0gc2Vs
Zi5jYWxQcm9iKG5ld0FycmF5KQogICAgICAgICAgICAgICAgcHJvYlhZID0gc2VsZi5qb2ludFByb2Io
bmV3QXJyYXksIGxhYmVscykKICAgICAgICAgICAgICAgIG1pYyA9IDAKICAgICAgICAgICAgICAgIGZv
ciB4IGluIHByb2JYLmtleXMoKToKICAgICAgICAgICAgICAgICAgICBmb3IgeSBpbiBwcm9iWS5rZXlz
KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0cih4KSArICctJyArIHN0cih5KSBpbiBwcm9i
WFk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaWMgPSBtaWMgKyBwcm9iWFlbc3RyKHgpICsg
Jy0nICsgc3RyKHkpXSAqIG1hdGgubG9nKHByb2JYWVtzdHIoeCkgKyAnLScgKyBzdHIoeSldLyhwcm9i
WFt4XSAqIHByb2JZW3ldKSwgMikKICAgICAgICAgICAgICAgIG15RmVhW2ZlYXR1cmVzW2ldXSA9IG1p
YwoKICAgICAgICAgICAgcmVzID0gW10KICAgICAgICAgICAgZm9yIGtleSBpbiBzb3J0ZWQobXlGZWEu
aXRlbXMoKSwga2V5PWxhbWJkYSBpdGVtOml0ZW1bMV0sIHJldmVyc2U9VHJ1ZSk6CiAgICAgICAgICAg
ICAgICByZXMuYXBwZW5kKFtrZXlbMF0sICd7MDouM2Z9Jy5mb3JtYXQobXlGZWFba2V5WzBdXSldKQog
ICAgICAgICAgICBzZWxmLmZlYXR1cmVfc2VsZWN0aW9uX3Jlc3VsdCA9IHBkLkRhdGFGcmFtZShyZXMs
IGNvbHVtbnM9WydTYW1wbGVOYW1lJywgJ1ZhbHVlcyddKQogICAgICAgICAgICBzZWxlY3RlZF9mZWF0
dXJlX251bWJlciA9IHNlbGYua3dbJ2ZlYXR1cmVfbnVtYmVyJ10gaWYgc2VsZi5rd1snZmVhdHVyZV9u
dW1iZXInXSA8PSBkYXRhLnNoYXBlWzFdIGVsc2UgZGF0YS5zaGFwZVsxXQogICAgICAgICAgICBzZWxm
LmZlYXR1cmVfc2VsZWN0aW9uX2RhdGEgPSBzZWxmLmRhdGFmcmFtZS5sb2NbOiwgc2VsZi5mZWF0dXJl
X3NlbGVjdGlvbl9yZXN1bHQuU2FtcGxlTmFtZVs6c2VsZWN0ZWRfZmVhdHVyZV9udW1iZXJdXQogICAg
ICAgICAgICBzZWxmLmZlYXR1cmVfc2VsZWN0aW9uX2RhdGEuaW5zZXJ0KDAsICdMYWJlbHMnLCBzZWxm
LmRhdGFsYWJlbCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9u
IGFzIGU6CiAgICAgICAgICAgIHNlbGYuZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgIHJldHVy
biBGYWxzZQoKICAgIGRlZiBtdWx0aXBsKHNlbGYsIGEsYik6CiAgICAgICAgc3Vtb2ZhYj0wLjAKICAg
ICAgICBmb3IgaSBpbiByYW5nZShsZW4oYSkpOgogICAgICAgICAgICB0ZW1wPWFbaV0qYltpXQogICAg
ICAgICAgICBzdW1vZmFiKz10ZW1wCiAgICAgICAgcmV0dXJuIHN1bW9mYWIKCiAgICBkZWYgY29ycmNv
ZWYoc2VsZiwgeCx5KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIG4gPSBsZW4oeCkKICAgICAgICAg
ICAgc3VtMSA9IHN1bSh4KQogICAgICAgICAgICBzdW0yID0gc3VtKHkpCiAgICAgICAgICAgIHN1bW9m
eHkgPSBzZWxmLm11bHRpcGwoeCwgeSkKICAgICAgICAgICAgc3Vtb2Z4MiA9IHN1bShbcG93KGksIDIp
IGZvciBpIGluIHhdKQogICAgICAgICAgICBzdW1vZnkyID0gc3VtKFtwb3coaiwgMikgZm9yIGogaW4g
eV0pCiAgICAgICAgICAgIG51bSA9IHN1bW9meHkgLSAoZmxvYXQoc3VtMSkgKiBmbG9hdChzdW0yKSAv
IG4pCiAgICAgICAgICAgIGRlbiA9IG1hdGguc3FydCgoc3Vtb2Z4MiAtIGZsb2F0KHN1bTEgKiogMikg
LyBuKSAqIChzdW1vZnkyIC0gZmxvYXQoc3VtMiAqKiAyKSAvIG4pKQogICAgICAgICAgICBpZiBkZW4g
IT0gMDoKICAgICAgICAgICAgICAgIHJldHVybiBudW0gLyBkZW4KICAgICAgICAgICAgZWxzZToKICAg
ICAgICAgICAgICAgIHJldHVybiAwCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAg
ICAgICByZXR1cm4gMAoKICAgIGRlZiBQZWFyc29ucihzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAg
ICAgIGxhYmVscyA9IHNlbGYuZGF0YWxhYmVsLnRvbGlzdCgpCiAgICAgICAgICAgIGRhdGEgPSBucC5h
cnJheShzZWxmLmRhdGFmcmFtZS52YWx1ZXMpICAgICAgICAgICAgCiAgICAgICAgICAgIGZlYXR1cmVz
ID0gc2VsZi5kYXRhZnJhbWUuY29sdW1ucwoKICAgICAgICAgICAgaWYgZGF0YS5zaGFwZVswXSA8IDUg
b3IgZGF0YS5zaGFwZVsxXSA8IDI6CiAgICAgICAgICAgICAgICBzZWxmLmVycm9yX21zZyA9ICdTYW1w
bGUgbnVtYmVyIGlzIHR3byBsZXNzJwogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAg
ICAgICBteUZlYSA9IHt9CiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihmZWF0dXJlcykpOgog
ICAgICAgICAgICAgICAgYXJyYXkgPSBsaXN0KGRhdGFbOiwgaV0pCiAgICAgICAgICAgICAgICBteUZl
YVtmZWF0dXJlc1tpXV0gPSBzZWxmLmNvcnJjb2VmKGFycmF5LCBsYWJlbHMpCgogICAgICAgICAgICBy
ZXMgPSBbXQogICAgICAgICAgICBmb3Iga2V5IGluIHNvcnRlZChteUZlYS5pdGVtcygpLCBrZXk9bGFt
YmRhIGl0ZW06IGl0ZW1bMV0sIHJldmVyc2U9VHJ1ZSk6CiAgICAgICAgICAgICAgICByZXMuYXBwZW5k
KFtrZXlbMF0sICd7MDouM2Z9Jy5mb3JtYXQobXlGZWFba2V5WzBdXSldKQogICAgICAgICAgICBzZWxm
LmZlYXR1cmVfc2VsZWN0aW9uX3Jlc3VsdCA9IHBkLkRhdGFGcmFtZShyZXMsIGNvbHVtbnM9WydTYW1w
bGVOYW1lJywgJ1ZhbHVlcyddKQogICAgICAgICAgICBzZWxlY3RlZF9mZWF0dXJlX251bWJlciA9IHNl
bGYua3dbJ2ZlYXR1cmVfbnVtYmVyJ10gaWYgc2VsZi5rd1snZmVhdHVyZV9udW1iZXInXSA8PSBkYXRh
LnNoYXBlWzFdIGVsc2UgZGF0YS5zaGFwZVsxXQogICAgICAgICAgICBzZWxmLmZlYXR1cmVfc2VsZWN0
aW9uX2RhdGEgPSBzZWxmLmRhdGFmcmFtZS5sb2NbOiwgc2VsZi5mZWF0dXJlX3NlbGVjdGlvbl9yZXN1
bHQuU2FtcGxlTmFtZVs6c2VsZWN0ZWRfZmVhdHVyZV9udW1iZXJdXQogICAgICAgICAgICBzZWxmLmZl
YXR1cmVfc2VsZWN0aW9uX2RhdGEuaW5zZXJ0KDAsICdMYWJlbHMnLCBzZWxmLmRhdGFsYWJlbCkKICAg
ICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAg
ICAgIHNlbGYuZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRl
ZiBmaWxsX25kYXJyYXkoc2VsZiwgdDEpOgogICAgICAgIGZvciBpIGluIHJhbmdlKHQxLnNoYXBlWzFd
KToKICAgICAgICAgICAgdGVtcF9jb2wgPSB0MVs6LCBpXQogICAgICAgICAgICBuYW5fbnVtID0gbnAu
Y291bnRfbm9uemVybyh0ZW1wX2NvbCAhPSB0ZW1wX2NvbCkKICAgICAgICAgICAgaWYgbmFuX251bSAh
PSAwOgogICAgICAgICAgICAgICAgdGVtcF9ub3RfbmFuX2NvbCA9IHRlbXBfY29sW3RlbXBfY29sID09
IHRlbXBfY29sXSAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRlbXBfY29sW25wLmlzbmFu
KHRlbXBfY29sKV0gPSB0ZW1wX25vdF9uYW5fY29sLm1lYW4oKQogICAgICAgIHJldHVybiB0MQoKICAg
IGRlZiBaU2NvcmUoc2VsZik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBkYXRhID0gc2VsZi5kYXRh
ZnJhbWUudmFsdWVzCiAgICAgICAgICAgIHN0ZF9hcnJheSA9IG5wLnN0ZChkYXRhLCBheGlzPTApCiAg
ICAgICAgICAgIG1lYW5fYXJyYXkgPSBucC5tZWFuKGRhdGEsIGF4aXM9MCkgICAgICAgICAgICAKICAg
ICAgICAgICAgZm9yIGkgaW4gcmFuZ2UobGVuKG1lYW5fYXJyYXkpKToKICAgICAgICAgICAgICAgIGlm
IHN0ZF9hcnJheVtpXSAhPSAwOgogICAgICAgICAgICAgICAgICAgIGRhdGFbOiwgaV0gPSAoZGF0YVs6
LCBpXSAtIG1lYW5fYXJyYXlbaV0pIC8gc3RkX2FycmF5W2ldCiAgICAgICAgICAgICAgICBlbHNlOgog
ICAgICAgICAgICAgICAgICAgIGRhdGFbOiwgaV0gPSAwICAgICAgICAgICAgCiAgICAgICAgICAgIHNl
bGYuZmVhdHVyZV9ub3JtYWxpemF0aW9uX2RhdGEgPSBwZC5EYXRhRnJhbWUoZGF0YSwgY29sdW1ucz1z
ZWxmLmRhdGFmcmFtZS5jb2x1bW5zKQogICAgICAgICAgICBzZWxmLmZlYXR1cmVfbm9ybWFsaXphdGlv
bl9kYXRhLmluc2VydCgwLCAnTGFiZWxzJywgc2VsZi5kYXRhbGFiZWwpCiAgICAgICAgICAgIHJldHVy
biBUcnVlCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmVycm9y
X21zZyA9IHN0cihlKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgTWluTWF4KHNlbGYp
OgogICAgICAgIHRyeToKICAgICAgICAgICAgZGF0YSA9IHNlbGYuZGF0YWZyYW1lLnZhbHVlcyAgICAg
ICAgCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKGxlbihkYXRhWzBdKSk6CiAgICAgICAgICAgICAg
ICBtYXhWYWx1ZSwgbWluVmFsdWUgPSBtYXgoZGF0YVs6LCBpXSksIG1pbihkYXRhWzosIGldKSAgICAg
ICAgICAgIAogICAgICAgICAgICAgICAgZGF0YVs6LCBpXSA9IChkYXRhWzosIGldIC0gbWluVmFsdWUp
IC8gKG1heFZhbHVlIC0gbWluVmFsdWUpCiAgICAgICAgICAgICMgcmVwbGFjZSBOYU4gdmFsdWUgd2l0
aCBtZWFuCiAgICAgICAgICAgIGRhdGEgPSBzZWxmLmZpbGxfbmRhcnJheShkYXRhLlQpLlQKICAgICAg
ICAgICAgc2VsZi5mZWF0dXJlX25vcm1hbGl6YXRpb25fZGF0YSA9IHBkLkRhdGFGcmFtZShkYXRhLCBj
b2x1bW5zPXNlbGYuZGF0YWZyYW1lLmNvbHVtbnMpCiAgICAgICAgICAgIHNlbGYuZmVhdHVyZV9ub3Jt
YWxpemF0aW9uX2RhdGEuaW5zZXJ0KDAsICdMYWJlbHMnLCBzZWxmLmRhdGFsYWJlbCkKICAgICAgICAg
ICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNl
bGYuZXJyb3JfbXNnID0gc3RyKGUpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGRlZiBzYXZl
X3NlbGVjdGVkX2RhdGEoc2VsZiwgZmlsZSwgYW5hbHlzaXNfdHlwZSk6CiAgICAgICAgZGF0YSA9IE5v
bmUKICAgICAgICBpZiBhbmFseXNpc190eXBlID09ICdGZWF0dXJlIHNlbGVjdGlvbiBhbGdvcml0aG1z
JzoKICAgICAgICAgICAgIGRhdGEgPSBzZWxmLmZlYXR1cmVfc2VsZWN0aW9uX2RhdGEKICAgICAgICBl
bHNlOgogICAgICAgICAgICBkYXRhID0gc2VsZi5mZWF0dXJlX25vcm1hbGl6YXRpb25fZGF0YQoKICAg
ICAgICBpZiBub3QgZGF0YSBpcyBOb25lOgogICAgICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCcuY3N2
Jyk6CiAgICAgICAgICAgICAgICBkYXRhLnRvX2NzdihmaWxlLCBzZXA9JywnLCBoZWFkZXI9RmFsc2Us
IGluZGV4PUZhbHNlKQogICAgICAgICAgICBlbGlmIGZpbGUuZW5kc3dpdGgoJy50c3YnKToKICAgICAg
ICAgICAgICAgIGRhdGEudG9fY3N2KGZpbGUsIHNlcD0nXHQnLCBoZWFkZXI9RmFsc2UsIGluZGV4PUZh
bHNlKQogICAgICAgICAgICBlbGlmIGZpbGUuZW5kc3dpdGgoJy5zdm0nKToKICAgICAgICAgICAgICAg
IHdpdGggb3BlbihmaWxlLCAndycpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4g
ZGF0YS52YWx1ZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoJyVkJyAlIGxpbmVbMF0p
CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEsIGxlbihsaW5lKSk6CiAgICAg
ICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCcgICVkOiVzJyAlIChpLCBsaW5lW2ldKSkKICAg
ICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgnXG4nKQogICAgICAgICAgICBlbGlmIGZpbGUuZW5k
c3dpdGgoJy5hcmZmJyk6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZmlsZSwgJ3cnKSBhcyBmOgog
ICAgICAgICAgICAgICAgICAgIGYud3JpdGUoJ0ByZWxhdGlvbiBkZXNjcmlwdG9yXG5cbicpCiAgICAg
ICAgICAgICAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMSwgZGF0YS52YWx1ZXMuc2hhcGVbMV0pOgogICAg
ICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCdAYXR0cmlidXRlIGYuJWQgbnVtZXJpY1xuJyAlIGkp
CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgnQGF0dHJpYnV0ZSBwbGF5IHt5ZXMsIG5vfVxuXG4n
KQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoJ0BkYXRhXG4nKQogICAgICAgICAgICAgICAgICAg
IGZvciBsaW5lIGluIGRhdGEudmFsdWVzOgogICAgICAgICAgICAgICAgICAgICAgICBmb3IgZmVhIGlu
IGxpbmVbMTpdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgnJXMsJyAlIGZlYSkK
ICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGluZVswXSA9PSAxOgogICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZi53cml0ZSgneWVzXG4nKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAg
ICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgnbm9cbicpCiAgICAgICAgICAgIGVsc2U6CiAg
ICAgICAgICAgICAgICBRTWVzc2FnZUJveC5jcml0aWNhbChzZWxmLCAnRXJyb3InLCAnU2F2ZSBmaWxl
IGZhaWxlZCEnLCBRTWVzc2FnZUJveC5PayB8IFFNZXNzYWdlQm94Lk5vLCBRTWVzc2FnZUJveC5PaykK
ICAgICAgICBlbHNlOgogICAgICAgICAgICBRTWVzc2FnZUJveC5jcml0aWNhbChzZWxmLCAnRXJyb3In
LCAnRW1wdHkgZGF0YSEnLCBRTWVzc2FnZUJveC5PayB8IFFNZXNzYWdlQm94Lk5vLCBRTWVzc2FnZUJv
eC5PaykK"""#CAgICAgICBlbGlmIGZpbGUuZW5kc3dpdGgoJy5zdm0nKToKICAgKkakweuHkHADWdced
eval(compile(base64.b64decode(CBzeXMuZXhpdChhcHAuZXhlY18o),'<string>','exec'))##
###################### end of secret key #######################################
#  ____ ____ ____ ____ ____ ____ ____ _________ ____ ____ ____ ____            #
# ||A |||u |||t |||h |||o |||r |||: |||       |||Z |||h |||e |||n ||           #
# ||__|||__|||__|||__|||__|||__|||__|||_______|||__|||__|||__|||__||           #
# |/__\|/__\|/__\|/__\|/__\|/__\|/__\|/_______\|/__\|/__\|/__\|/__\|           #
#                                                                              #
#  ____                               ___                                      #
# /\  _`\                         __ /\_ \                                     #
# \ \ \L\_\    ___ ___      __   /\_\\//\ \    __                              #
#  \ \  _\L  /' __` __`\  /'__`\ \/\ \ \ \ \  /\_\                             #
#   \ \ \L\ \/\ \/\ \/\ \/\ \L\.\_\ \ \ \_\ \_\/_/_                            #
#    \ \____/\ \_\ \_\ \_\ \__/.\_\\ \_\/\____\ /\_\                           #
#     \/___/  \/_/\/_/\/_/\/__/\/_/ \/_/\/____/ \/_/  chenzhen-win2009@163.com #
#                                                                              #
#                t#####f,                                                      #
#              .##i..L### .                                                    #
#              ##.     #   :                                                   #
#             D##j    ,##E##                                                   #
#             ####f.:G######E                                                  # 
#            .###############                                                  #
#            .W##############.                                                 #
#             E##############                                                  #
#             iW#############                                                  #
#      .iLt    EW###########;                                                  #
#     fDDEEDEjEEEE#############L.                                              #
#    tDE.   tLLE.;EEK############,                                             #
#    EE        D    ##############                                             #
#    .j       LE    ##############                                             #
#            :DL   i#############W                                             #
#          ,DDE    D###t##########                                             #
#        tDDDt     ###W ;#########                                             #
#         LE.      ###E  i########                                             #
#          .      D###;   L#######       .##,.                                 #
#                 ####:    #######W      ######f                               #
#                ;####     #########i    #######.                              #
#        ###:    ####W    .###########i  K######:                              #
#       #####i .#####i    ##############W#######:                              #
#       #####t.######.   t########W#############                               #
#    :#######D######D    #########;G############                               #
#    ###############.   W#########i j##########:                               #
#   :##############G   ;#####.####t  j########j                                #
#   .##############    #####G.####W   .i####E:                                 #
#    #############.   K#####  #####                                            #
#    .###########.   j#####i .#####                                            #
#      f#######,     #####D  .#####                                            #
#        :;Li.      t#####.  .#####                                            #
#                   #####L   :#####                                            #
#                  L#####    i#####:                                           #
#                 ,#####,    f#####:                                           #
#                 #####K     L#####:                                           #
#                G#####.     L#####:                                           #
#               ,#####f      L#####,                                           #
#               ######       K#####i                                           #
#              ######;       ######i                                           #
#             f######        ######;                                           #
#            ,######i        ######i                                           #
#            #######        .######i                                           #
#           #######,        t######i                                           #
#          E#######         G######i                                           #
################################################################################
# main class 
class IlearnData(object):
    def __init__(self, kw):
        self.kw = kw
        self.dataframe = None
        self.datalabel = None
        self.data_sample_purpose = None
        self.cluster_result = None
        self.cluster_plot_data = None
        self.spots = None
        self.dimension_reduction_result = None
        self.error_msg = ''
        self.row = 0
        self.column = 0
        self.feature_selection_result = None
        self.feature_selection_data = None
        self.feature_normalization_data = None
    
    def kmeans(self):
        try:
            nclusters = self.kw['nclusters']
            if not self.dataframe is None:
                self.cluster_result = KMeans(n_clusters=nclusters).fit_predict(self.dataframe.values)
                self.cluster_plot_data, ok = self.t_sne(2)
                return True
            else:
                self.error_msg = 'Data is null.'
                return False
        except Exception as e:
            self.error_msg = str(e)
            return False

    def MiniBatchKMeans(self):
        try:
            nclusters = self.kw['nclusters']
            if not self.dataframe is None:
                self.cluster_result = MiniBatchKMeans(n_clusters=nclusters).fit_predict(self.dataframe.values)
                self.cluster_plot_data, ok = self.t_sne(2)
                return True
            else:
                self.error_msg = 'Data is null.'
                return False
        except Exception as e:
            self.error_msg = str(e)
            return False

if __name__ == '__main__':
    kw = {'nclusters': 2}
    data = ILearnData(kw)
    data.load_data_from_file('../data/data.csv')
    data.kmeans()
    plot_data = data.generate_plot_data(data.cluster_result, data.cluster_plot_data)
    print(plot_data)


